<!-- 
VS Code Code Counter Extension

Copyright (c) 2025 DelightfulGames
Licensed under the MIT License

Repository: https://github.com/DelightfulGames/vscode-code-counter
Marketplace: https://marketplace.visualstudio.com/items?itemName=DelightfulGames.vscode-code-counter
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Counter Emoji Settings</title>
    <link rel="stylesheet" href="{{cssUri}}">
</head>
<body>
    <div class="main-container">
        <div class="settings-layout-container">
            <div class="directory-sections-container emoji-sections-wrapper" id="emojiSectionsContainer">
                <h1>âš™ï¸ Code Counter Settings</h1>
                
                <!-- Dynamic Workspace Path Header -->
                <div class="dynamic-workspace-header" id="dynamicWorkspaceHeader" style="display: none;"></div>
                
                <!-- Workspace Mode Indicator -->
                <div class="workspace-mode-indicator workspace-only" id="workspaceModeIndicator" style="display: none;">
                    <div class="mode-legend">
                        <div class="legend-item workspace-root-legend">
                            <span class="legend-color">
                                <span class="legend-text">ğŸ“ Workspace Root Settings (Green)</span>
                            </span>
                        </div>
                        <div class="legend-item sub-workspace-legend">
                            <span class="legend-color">
                                <span class="legend-text">ğŸ“‚ Sub-workspace Settings (Magenta)</span>                                
                            </span>                            
                        </div>
                    </div>
                </div>

                <div class="directory-type-section">
                    <h2>ğŸ“„-ğŸŸ¢ğŸŸ¡ğŸ”´ File Badges (individual files)</h2>
                    <div class="emoji-horizontal-container">
                        <div class="emoji-config-item">
                            <h4>Low</h4>
                            <div class="inheritance-info workspace-only">
                                <small>Parent:</small>
                                <small>{{parentFileNormalSource}} - {{parentFileNormal}}</small>
                            </div>
                            <div class="current-emoji" data-color-key="low" data-type="file" onclick="openEmojiPicker('low', 'file')">
                                {{badges.low}}
                                <button class="emoji-reset-btn workspace-only" onclick="resetField(event, 'emoji', 'low')" title="Reset to parent setting">ğŸ”</button>                                
                            </div>
                            <div class="threshold-container">
                                <label>< </label>
                                <span class="threshold-span">
                                    <input type="number" class="threshold-input" id="midThreshold" value="{{thresholds.mid}}" min="1" onchange="updateThreshold('mid', this.value)" />
                                    <button class="emoji-reset-btn workspace-only" onclick="resetField(event, 'threshold', 'warning')" title="Reset to parent setting">ğŸ”</button>
                                </span>
                                <span> lines</span>                                
                            </div>
                            <div class="inheritance-info workspace-only">
                                <small>Threshold Parent:</small>
                                <small>{{parentWarningThresholdSource}} - {{parentWarningThreshold}}</small>
                            </div>

                            <div class="preview" id="lowPreview">{{badges.low}} {{lowPreviewLines}} lines</div>                            
                        </div>
                        
                        <div class="emoji-config-item">
                            <h4>Medium</h4>
                            <div class="inheritance-info workspace-only">
                                <small>Parent:</small>
                                <small>{{parentFileWarningSource}} - {{parentFileWarning}}</small>
                            </div>
                            <div class="current-emoji" data-color-key="medium" data-type="file" onclick="openEmojiPicker('medium', 'file')">
                                {{badges.medium}}                                
                                <button class="emoji-reset-btn workspace-only" onclick="resetField(event, 'emoji', 'medium')" title="Reset to parent setting">ğŸ”</button>
                            </div>
                            <div class="threshold-container">
                                <label>< </label>
                                <span class="threshold-span">
                                    <input type="number" class="threshold-input" id="highThreshold" value="{{thresholds.high}}" min="1" max="9999" onchange="updateThreshold('high', this.value)" />
                                    <button class="emoji-reset-btn workspace-only" onclick="resetField(event, 'threshold', 'danger')" title="Reset to parent setting">ğŸ”</button>
                                </span>                                
                                <span> lines</span>
                            </div>
                            <div class="inheritance-info workspace-only">
                                <small>Threshold Parent:</small>
                                <small>{{parentDangerThresholdSource}} - {{parentDangerThreshold}}</small>
                            </div>                            
                            <div class="preview" id="mediumPreview">{{badges.medium}} {{mediumPreviewLines}} lines</div>
                        </div>
                        
                        <div class="emoji-config-item">
                            <h4>High</h4>
                            <div class="inheritance-info workspace-only">
                                <small>Parent:</small>
                                <small>{{parentFileDangerSource}} - {{parentFileDanger}}</small>
                            </div>
                            <div class="current-emoji" data-color-key="high" data-type="file" onclick="openEmojiPicker('high', 'file')">
                                {{badges.high}}                                
                                <button class="emoji-reset-btn workspace-only" onclick="resetField(event, 'emoji', 'high')" title="Reset to parent setting">ğŸ”</button>
                            </div>
                            <div class="threshold-container">
                                <label>â‰¥ <strong>{{thresholds.high}}</strong> lines</label>
                            </div>
                            <div class="preview" id="highPreview">{{badges.high}} {{highPreviewLines}} lines</div>
                            <h3>ğŸ”œğŸ‘€ More coming soon!</h3>
                        </div>
                    </div>
                </div>
                
                <div class="directory-type-section">
                    <h2>ğŸ“-ğŸŸ©ğŸŸ¨ğŸŸ¥ Folder Badges (average | maximum lines)</h2>
                    <div class="emoji-horizontal-container">
                        <div class="emoji-config-item">
                            <h4>Low</h4>
                            <div class="inheritance-info workspace-only">
                                <small>Parent:</small>
                                <small>{{parentFolderNormalSource}} - {{parentFolderNormal}}</small>
                            </div>
                            <div class="current-emoji" data-color-key="low" data-type="folder" onclick="openEmojiPicker('low', 'folder')">
                                {{folderBadges.low}}                                
                                <button class="emoji-reset-btn workspace-only" onclick="resetField(event, 'folderEmoji', 'low')" title="Reset to parent setting">ğŸ”</button>
                            </div>
                            <div class="threshold-container">
                                <label>< {{thresholds.mid}} lines</label>
                            </div>
                            <div class="preview" id="lowFolderPreview">{{folderBadges.low}} Avg: {{lowFolderAvg}} | {{badges.low}} Max: {{thresholds.mid}}</div>
                        </div>
                        
                        <div class="emoji-config-item">
                            <h4>Medium</h4>
                            <div class="inheritance-info workspace-only">
                                <small>Parent:</small>
                                <small>{{parentFolderWarningSource}} - {{parentFolderWarning}}</small>
                            </div>
                            <div class="current-emoji" data-color-key="medium" data-type="folder" onclick="openEmojiPicker('medium', 'folder')">
                                {{folderBadges.medium}}                                
                                <button class="emoji-reset-btn workspace-only" onclick="resetField(event, 'folderEmoji', 'medium')" title="Reset to parent setting">ğŸ”</button>
                            </div>
                            <div class="threshold-container">
                                <label>< {{thresholds.high}} lines</label>
                            </div>
                            <div class="preview" id="mediumFolderPreview">{{folderBadges.medium}} Avg: {{mediumFolderAvg}} | {{badges.medium}} Max: {{thresholds.high}}</div>
                        </div>
                        
                        <div class="emoji-config-item">
                            <h4>High</h4>
                            <div class="inheritance-info workspace-only">
                                <small>Parent:</small>
                                <small>{{parentFolderDangerSource}} - {{parentFolderDanger}}</small>
                            </div>
                            <div class="current-emoji" data-color-key="high" data-type="folder" onclick="openEmojiPicker('high', 'folder')">
                                {{folderBadges.high}}                                
                                <button class="emoji-reset-btn workspace-only" onclick="resetField(event, 'folderEmoji', 'high')" title="Reset to parent setting">ğŸ”</button>     
                            </div>
                            <div class="threshold-container">
                                <label>â‰¥ {{thresholds.high}} lines</label>
                            </div>
                            <div class="preview" id="highFolderPreview">{{folderBadges.high}} Avg: {{highFolderAvg}} | {{badges.high}} Max: {{highFolderMax}}</div>
                        </div>
                    </div>
                </div>

                <div class="reset-section">
                    <button class="reset-button" onclick="resetEmojis()">ğŸ”„ Reset All Emojis to Parent/Defaults</button>
                </div>

                <!-- GitHub Integration Section -->
                <div class="color-section">
                    <h3>ğŸ™ GitHub Integration</h3>
                    <details open>
                        <summary>Request support for unsupported file extensions:</summary>
                        <div class="github-integration-container">
                            <div class="extension-input-container">
                                <label for="githubExtensionInput">File extension:</label>
                                <input type="text" id="githubExtensionInput" placeholder="Enter extension (e.g., .kt, .swift, .zig)" />
                            </div>
                            <div class="github-actions-container">
                                <button onclick="searchGitHubIssues()" class="github-button search-button">
                                    ğŸ” Search Existing Issues
                                </button>
                                <button onclick="createGitHubIssue()" class="github-button create-button">
                                    â• Create New Issue
                                </button>
                            </div>
                            <div class="github-results" id="githubResults" style="display: none;">
                                <!-- Dynamic content populated by JavaScript -->
                            </div>
                        </div>
                        <div class="github-info">
                            <div class="info-content">
                                <strong>ğŸ“ How it works:</strong>
                                <ul>
                                    <li><strong>Search:</strong> Searches existing GitHub issues for extension support requests</li>
                                    <li><strong>Create:</strong> Opens a new GitHub issue with pre-filled template for requesting extension support</li>
                                    <li><strong>Community-driven:</strong> Help prioritize which file extensions to add next</li>
                                </ul>
                                <div class="integration-note">
                                    <strong>Note:</strong> This feature uses GitHub's web interface and requires an internet connection. No authentication is required for searching or creating issues.
                                </div>
                            </div>
                        </div>
                    </details>
                </div>

                <div class="color-section">
                    <h3>ğŸ«£ Exclude Patterns</h3>
                    <details open>
                        <summary>Glob patterns for files to exclude from line counting:</summary>
                        <div class="glob-patterns-container">
                            {{excludePatterns}}
                        </div>
                        <div class="add-pattern-container">
                            <input type="text" id="newPattern" placeholder="Enter glob pattern (e.g., **/*.tmp)" />
                            <button onclick="addPattern()">â• Add Pattern</button>
                        </div>
                        <div class="pattern-examples">
                            <details>
                                <summary>ğŸ“– Pattern Examples</summary>
                                <ul>
                                    <li><code>**/node_modules/**</code> - Exclude all node_modules folders</li>
                                    <li><code>**/*.tmp</code> - Exclude all .tmp files</li>
                                    <li><code>**/dist/**</code> - Exclude all dist folders</li>
                                    <li><code>**/.git/**</code> - Exclude all .git folders</li>
                                    <li><code>**/test/**</code> - Exclude all test folders</li>
                                    <li><code>**/*.min.js</code> - Exclude minified JS files</li>
                                </ul>
                            </details>
                        </div>
                        <button onclick="resetPatterns()" class="reset-button">ğŸ”„ Reset Exclude Patterns to Parent/Defaults</button>
                    </details>
                </div>

                <div class="color-section">
                    <h3>ğŸŒ Include Patterns (Whitelist)</h3>
                    <details open>
                        <summary>Glob patterns for files to include even if they match exclusion patterns:</summary>
                        <!-- Safety Warning for Include Patterns -->
                        <div class="safety-warning">
                            <div class="warning-icon">âš ï¸</div>
                            <div class="warning-content">
                                <strong>ğŸ›¡ï¸ Safety Warning:</strong> Include patterns bypass Code Counter's binary file detection and safety checks. Files matching include patterns will be processed as text files regardless of their actual content or extension. This could result in:
                                <ul>
                                    <li>Performance issues with large binary files</li>
                                    <li>Incorrect line counts for non-text files</li>
                                    <li>Processing of potentially unsafe file content</li>
                                </ul>
                                <strong>ğŸ€„ğŸ² Use include patterns only for files you know are safe text files. ğŸ²ğŸ€„</strong>
                            </div>
                        </div>

                        <div class="glob-patterns-container">
                            {{includePatterns}}
                        </div>
                        <div class="add-pattern-container">
                            <input type="text" id="newIncludePattern" placeholder="Enter glob pattern (e.g., **/*.spec.ts)" />
                            <button onclick="addIncludePattern()">â• Add Pattern</button>
                        </div>
                        <div class="pattern-examples">
                            <details>
                                <summary>ğŸ“– Pattern Examples</summary>
                                <ul>
                                    <li><code>**/*.spec.ts</code> - Include all test files even if tests folder is excluded</li>
                                    <li><code>node_modules/important/**</code> - Include specific important dependencies</li>
                                    <li><code>build/**/*.map</code> - Include source maps from build folder</li>
                                    <li><code>**/README.md</code> - Include all README files</li>
                                    <li><code>dist/types/**</code> - Include TypeScript declaration files</li>
                                    <li><code>**/*.config.*</code> - Include all configuration files</li>
                                </ul>
                                <div class="pattern-info">
                                    <strong>Note:</strong> Inclusion patterns override exclusion patterns. If a file matches both, it will be included.
                                </div>
                            </details>
                        </div>
                        <button onclick="resetIncludePatterns()" class="reset-button">ğŸ”„ Reset Inclusion Patterns to Parent/Defaults</button>
                    </details>
                </div>
            </div>
            <div class="workspace-settings-sidebar">
                <div class="color-section">
                    <h3>ğŸ› Debug Service</h3>
                    <details {{debugActive}}>
                        <summary>Having issues?</summary>
                        <p>Select a debug output location to help diagnose problems:</p>
                        <div id="backend-developer-tools" style="display: none;">
                            1. Configure extension debug logging output.<br />
                            2. Open VS Code Developer Console to view logs (Help â†’ Toggle Developer Tools).<br />
                            3. Reproduce the issue and copy [Console] output.<br />
                            4. Open an issue on GitHub with the log details. <a href="https://github.com/DelightfulGames/vscode-code-counter/issues">GitHub issues</a>
                        </div>
                        <div id="backend-file" style="display: none;">
                            1. Configure extension debug logging output.<br />
                            2. Reproduce the issue and come back to this menu.<br />
                            3. Select "None" (turns file debugger off)<br />
                            4. Open an issue on GitHub with the log details. <a href="https://github.com/DelightfulGames/vscode-code-counter/issues">GitHub issues</a>
                        </div>                                                    
                        <div class="debug-service-container">
                            <div class="debug-backend-container">
                                <label for="debugBackend">Output Location:</label>
                                <select id="debugBackend" onchange="updateDebugService()">
                                    <option value="none" {{debugBackendNoneSelected}}>None (No Logging)</option>
                                    <option value="console" {{debugBackendConsoleSelected}}>Developer Tools Console</option>
                                    <option value="file" {{debugBackendFileSelected}}>File Log - debug.log</option>
                                </select>
                            </div>
                            <div class="debug-file-link-container" id="debugFileLink" style="display: none;">
                                <label>Debug Log File:</label>
                                <a href="#" onclick="openDebugLogFile()" class="debug-log-link">ğŸ“„ Open .vscode/code-counter/debug.log</a>
                            </div>
                            <div class="debug-actions-container">
                                <label>Cache Management:</label>
                                <button onclick="invalidateBinaryCache()" class="debug-action-button" title="Clear binary file detection cache">ğŸ—‘ï¸ Invalidate Binary Cache</button>
                            </div>
                        </div>
                    </details>
                </div>

                {{workspaceSettings}}
                <div class="color-section">
                    <h3>ğŸ“¤ Output Directory</h3>
                    <details open>
                        <summary>Directory where HTML and XML reports will be generated:</summary>
                        <div class="output-directory-container">
                            <div class="input-group">
                                <input type="text" id="outputDirectory" placeholder=".vscode/code-counter/reports" onchange="updateOutputDirectory(this.value)" value="{{outputDirectory}}">
                                <button onclick="browseOutputDirectory()" class="browse-button" title="Browse for directory">ğŸ“‚</button>
                            </div>
                            <div class="setting-description">
                                Relative to workspace root. Reports include detailed HTML views and XML data files with line count statistics.
                            </div>
                        </div>
                    </details>
                </div>

                <div class="color-section">
                    <h3>ğŸ”„ Auto-Generation</h3>
                    <details open>
                        <summary>Automatically generate reports when files are saved:</summary>
                        <div class="auto-generate-container">
                            <div class="checkbox-container">
                                <input type="checkbox" id="autoGenerate" {{autoGenerateChecked}} onchange="updateAutoGenerate(this.checked)">
                                <label for="autoGenerate">Auto-generate reports on file save</label>
                            </div>
                            <div class="setting-description">
                                When enabled, the extension will automatically regenerate HTML and XML reports whenever you save a file in the workspace. This keeps your code metrics up-to-date in real-time.
                            </div>
                        </div>
                    </details>                    
                </div>

                <div class="color-section">
                    <h3>ğŸ’¬ Notification Settings</h3>
                    <details open>
                        <summary>Control when the extension shows popup notifications:</summary>
                        <div class="notification-settings-container">
                            <div class="checkbox-container">
                                <input type="checkbox" id="showNotificationOnAutoGenerate" {{showNotificationChecked}} onchange="updateNotificationSetting(this.checked)">
                                <label for="showNotificationOnAutoGenerate">Show popup notifications when reports are auto-generated on file save</label>
                            </div>
                            <div class="setting-description">
                                When enabled, the extension will show a popup notification with a "View Report" button each time a report is automatically generated when you save a file. When disabled, reports are generated silently in the background.
                            </div>
                        </div>
                    </details>
                </div>
            </div>
        </div>

        <!-- Emoji Picker Modal -->
        <div class="emoji-picker-modal" id="emojiModal">
            <div class="emoji-picker">
                <div class="emoji-picker-header">
                    <h3>Select Emoji</h3>
                    <button class="emoji-picker-close" onclick="closeEmojiPicker()">âœ•</button>
                </div>
                <div class="emoji-search-container">
                    <input type="text" class="emoji-search-input" id="emojiSearch" placeholder="Search emojis... (e.g., 'smile', 'heart', 'red circle')" />
                </div>
                <div class="search-results-info" id="searchResultsInfo"></div>
                <div class="emoji-categories">
                    <button class="category-tab active" data-category="all" onclick="switchCategory('all')">All</button>
                    <button class="category-tab" data-category="smileys" onclick="switchCategory('smileys')">ğŸ˜€ Smileys</button>
                    <button class="category-tab" data-category="nature" onclick="switchCategory('nature')">ğŸŒ± Nature</button>
                    <button class="category-tab" data-category="food" onclick="switchCategory('food')">ğŸ Food</button>
                    <button class="category-tab" data-category="activities" onclick="switchCategory('activities')">âš½ Activities</button>
                    <button class="category-tab" data-category="travel" onclick="switchCategory('travel')">ğŸš— Travel</button>
                    <button class="category-tab" data-category="objects" onclick="switchCategory('objects')">ğŸ’¡ Objects</button>
                    <button class="category-tab" data-category="symbols" onclick="switchCategory('symbols')">ğŸ”´ Symbols</button>
                    <button class="category-tab" data-category="flags" onclick="switchCategory('flags')">ğŸ Flags</button>
                </div>
                <div class="emoji-grid-container">
                    <div class="emoji-grid" id="emojiGrid"></div>
                </div>
            </div>
        </div>

        <script>
            // Essential template data that needs to be embedded
            window.emojiData = {{emojiData}};
            window.emojiSearchData = {{emojiSearchData}};
            window.workspaceData = {{workspaceData}};
        </script>
        {{scriptTags}}
    </div>
</body>
</html>