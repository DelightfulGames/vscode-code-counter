<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Counter Emoji Settings</title>
    <link rel="stylesheet" href="{{cssUri}}">
</head>
<body>
    <div class="main-container">
        <div class="settings-layout-container">
            <div class="directory-sections-container emoji-sections-wrapper" id="emojiSectionsContainer">
                <h1>⚙️ Code Counter Settings</h1>
                
                <!-- Dynamic Workspace Path Header -->
                <div class="dynamic-workspace-header" id="dynamicWorkspaceHeader" style="display: none;"></div>
                
                <!-- Workspace Mode Indicator -->
                <div class="workspace-mode-indicator workspace-only" id="workspaceModeIndicator" style="display: none;">
                    <div class="mode-legend">
                        <div class="legend-item workspace-root-legend">
                            <span class="legend-color">
                                <span class="legend-text">📁 Workspace Root Settings (Green)</span>
                            </span>
                        </div>
                        <div class="legend-item sub-workspace-legend">
                            <span class="legend-color">
                                <span class="legend-text">📂 Sub-workspace Settings (Magenta)</span>                                
                            </span>                            
                        </div>
                    </div>
                </div>

                <div class="color-section">
                    <h3>🫣 Exclude Patterns</h3>
                    <details>
                        <summary>Glob patterns for files to exclude from line counting:</summary>
                        <div class="glob-patterns-container">
                            {{excludePatterns}}
                        </div>
                        <div class="add-pattern-container">
                            <input type="text" id="newPattern" placeholder="Enter glob pattern (e.g., **/*.tmp)" />
                            <button onclick="addPattern()">➕ Add Pattern</button>
                            <button class="emoji-reset-btn workspace-only" onclick="resetField(event, 'excludePatterns')" title="Reset to parent settings">Reset All Patterns</button>
                        </div>
                        <div class="pattern-examples">
                            <details>
                                <summary>📖 Pattern Examples</summary>
                                <ul>
                                    <li><code>**/node_modules/**</code> - Exclude all node_modules folders</li>
                                    <li><code>**/*.tmp</code> - Exclude all .tmp files</li>
                                    <li><code>**/dist/**</code> - Exclude all dist folders</li>
                                    <li><code>**/.git/**</code> - Exclude all .git folders</li>
                                    <li><code>**/test/**</code> - Exclude all test folders</li>
                                    <li><code>**/*.min.js</code> - Exclude minified JS files</li>
                                </ul>
                            </details>
                        </div>
                        <button onclick="resetPatterns()" class="reset-button">🔄 Reset Patterns to Parent/Defaults</button>
                    </details>
                </div>

                <div class="reset-section">
                    <button class="reset-button" onclick="resetEmojis()">🔄 Reset All Emojis to Defaults</button>
                </div>

                <div class="directory-type-section">
                    <h2>📄-🟢🟡🔴 File Badges (individual files)</h2>
                    <div class="emoji-horizontal-container">
                        <div class="emoji-config-item">
                            <h4>Low</h4>
                            <div class="inheritance-info workspace-only">
                                <small>Parent: {{parentFileNormal}}</small>
                            </div>

                            <div class="current-emoji" data-color-key="low" data-type="file" onclick="openEmojiPicker('low', 'file')">
                                {{badges.low}}
                                <button class="emoji-reset-btn workspace-only" onclick="resetField(event, 'emoji', 'low')" title="Reset to parent setting">🔁</button>                                
                            </div>
                            <div class="threshold-container">
                                <label>< </label>
                                <span class="threshold-span">
                                    <input type="number" class="threshold-input" id="midThreshold" value="{{thresholds.mid}}" min="1" onchange="updateThreshold('mid', this.value)" />
                                    <button class="emoji-reset-btn workspace-only" onclick="resetField(event, 'threshold', 'warning')" title="Reset to parent setting">🔁</button>
                                </span>
                                <span> lines</span>                                
                            </div>
                            <div class="inheritance-info workspace-only">
                                <small>Parent: {{parentWarningThreshold}}</small>
                            </div>

                            <div class="preview" id="lowPreview">{{badges.low}} {{lowPreviewLines}} lines</div>                            
                        </div>
                        
                        <div class="emoji-config-item">
                            <h4>Medium</h4>
                            <div class="inheritance-info workspace-only">
                                <small>Parent: {{parentFileWarning}}</small>
                            </div>

                            <div class="current-emoji" data-color-key="medium" data-type="file" onclick="openEmojiPicker('medium', 'file')">
                                {{badges.medium}}                                
                                <button class="emoji-reset-btn workspace-only" onclick="resetField(event, 'emoji', 'medium')" title="Reset to parent setting">🔁</button>
                            </div>
                            <div class="threshold-container">
                                <label>< </label>
                                <span class="threshold-span">
                                    <input type="number" class="threshold-input" id="highThreshold" value="{{thresholds.high}}" min="1" max="9999" onchange="updateThreshold('high', this.value)" />
                                    <button class="emoji-reset-btn workspace-only" onclick="resetField(event, 'threshold', 'danger')" title="Reset to parent setting">🔁</button>
                                </span>                                
                                <span> lines</span>
                            </div>
                            <div class="inheritance-info workspace-only">
                                <small>Parent: {{parentDangerThreshold}}</small>
                            </div>                            
                            <div class="preview" id="mediumPreview">{{badges.medium}} {{mediumPreviewLines}} lines</div>
                        </div>
                        
                        <div class="emoji-config-item">
                            <h4>High</h4>
                            <div class="inheritance-info workspace-only">
                                <small>Parent: {{parentFileDanger}}</small>
                            </div>

                            <div class="current-emoji" data-color-key="high" data-type="file" onclick="openEmojiPicker('high', 'file')">
                                {{badges.high}}                                
                                <button class="emoji-reset-btn workspace-only" onclick="resetField(event, 'emoji', 'high')" title="Reset to parent setting">🔁</button>
                            </div>
                            <div class="threshold-container">
                                <label>≥ <strong>{{thresholds.high}}</strong> lines</label>
                            </div>
                            <div class="preview" id="highPreview">{{badges.high}} {{highPreviewLines}} lines</div>
                            <h3>🔜👀 More coming soon!</h3>
                        </div>
                    </div>
                </div>
                
                <div class="directory-type-section">
                    <h2>📁-🟩🟨🟥 Folder Badges (average | maximum lines)</h2>
                    <div class="emoji-horizontal-container">
                        <div class="emoji-config-item">
                            <h4>Low</h4>
                            <div class="inheritance-info workspace-only">
                                <small>Parent: {{parentFolderNormal}}</small>
                            </div>
                            <div class="current-emoji" data-color-key="low" data-type="folder" onclick="openEmojiPicker('low', 'folder')">
                                {{folderBadges.low}}                                
                                <button class="emoji-reset-btn workspace-only" onclick="resetField(event, 'folderEmoji', 'low')" title="Reset to parent setting">🔁</button>
                            </div>
                            <div class="threshold-container">
                                <label>< {{thresholds.mid}} lines</label>
                            </div>
                            <div class="preview" id="lowFolderPreview">{{folderBadges.low}} Avg: {{lowFolderAvg}} | {{badges.low}} Max: {{thresholds.mid}}</div>
                        </div>
                        
                        <div class="emoji-config-item">
                            <h4>Medium</h4>
                            <div class="inheritance-info workspace-only">
                                <small>Parent: {{parentFolderWarning}}</small>
                            </div>
                            <div class="current-emoji" data-color-key="medium" data-type="folder" onclick="openEmojiPicker('medium', 'folder')">
                                {{folderBadges.medium}}                                
                                <button class="emoji-reset-btn workspace-only" onclick="resetField(event, 'folderEmoji', 'medium')" title="Reset to parent setting">🔁</button>
                            </div>
                            <div class="threshold-container">
                                <label>< {{thresholds.high}} lines</label>
                            </div>
                            <div class="preview" id="mediumFolderPreview">{{folderBadges.medium}} Avg: {{mediumFolderAvg}} | {{badges.medium}} Max: {{thresholds.high}}</div>
                        </div>
                        
                        <div class="emoji-config-item">
                            <h4>High</h4>
                            <div class="inheritance-info workspace-only">
                                <small>Parent: {{parentFolderDanger}}</small>
                            </div>
                            <div class="current-emoji" data-color-key="high" data-type="folder" onclick="openEmojiPicker('high', 'folder')">
                                {{folderBadges.high}}                                
                                <button class="emoji-reset-btn workspace-only" onclick="resetField(event, 'folderEmoji', 'high')" title="Reset to parent setting">🔁</button>     
                            </div>
                            <div class="threshold-container">
                                <label>≥ {{thresholds.high}} lines</label>
                            </div>
                            <div class="preview" id="highFolderPreview">{{folderBadges.high}} Avg: {{highFolderAvg}} | {{badges.high}} Max: {{highFolderMax}}</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="workspace-settings-sidebar">
                {{workspaceSettings}}

                <div class="color-section">
                    <h3>💬 Notification Settings</h3>
                    <p>Control when the extension shows popup notifications:</p>
                    <div class="notification-settings-container">
                        <div class="checkbox-container">
                            <input type="checkbox" id="showNotificationOnAutoGenerate" {{showNotificationChecked}} onchange="updateNotificationSetting(this.checked)">
                            <label for="showNotificationOnAutoGenerate">Show popup notifications when reports are auto-generated on file save</label>
                        </div>
                        <div class="setting-description">
                            When enabled, the extension will show a popup notification with a "View Report" button each time a report is automatically generated when you save a file. When disabled, reports are generated silently in the background.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Emoji Picker Modal -->
        <div class="emoji-picker-modal" id="emojiModal">
            <div class="emoji-picker">
                <div class="emoji-picker-header">
                    <h3>Select Emoji</h3>
                    <button class="emoji-picker-close" onclick="closeEmojiPicker()">✕</button>
                </div>
                <div class="emoji-search-container">
                    <input type="text" class="emoji-search-input" id="emojiSearch" placeholder="Search emojis... (e.g., 'smile', 'heart', 'red circle')" />
                </div>
                <div class="search-results-info" id="searchResultsInfo"></div>
                <div class="emoji-categories">
                    <button class="category-tab active" data-category="all" onclick="switchCategory('all')">All</button>
                    <button class="category-tab" data-category="smileys" onclick="switchCategory('smileys')">😀 Smileys</button>
                    <button class="category-tab" data-category="nature" onclick="switchCategory('nature')">🌱 Nature</button>
                    <button class="category-tab" data-category="food" onclick="switchCategory('food')">🍎 Food</button>
                    <button class="category-tab" data-category="activities" onclick="switchCategory('activities')">⚽ Activities</button>
                    <button class="category-tab" data-category="travel" onclick="switchCategory('travel')">🚗 Travel</button>
                    <button class="category-tab" data-category="objects" onclick="switchCategory('objects')">💡 Objects</button>
                    <button class="category-tab" data-category="symbols" onclick="switchCategory('symbols')">🔴 Symbols</button>
                    <button class="category-tab" data-category="flags" onclick="switchCategory('flags')">🏁 Flags</button>
                </div>
                <div class="emoji-grid-container">
                    <div class="emoji-grid" id="emojiGrid"></div>
                </div>
            </div>
        </div>

        <script>
            // Essential template data that needs to be embedded
            window.emojiData = {{emojiData}};
            window.emojiSearchData = {{emojiSearchData}};
            window.workspaceData = {{workspaceData}};
        </script>
        <script src="{{scriptUri}}"></script>
    </div>
</body>
</html>